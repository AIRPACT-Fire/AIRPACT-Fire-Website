{% extends "base/newbase.html" %}
{% block airpact-content %}

<div class="container">
	<div class="row">
		<div class="col">
			<div id="map" class="" style="border-radius: 1em; height: 200px; width: 100%;"> </div>
		</div>	
	</div>
	<div class="row">
		<div class="col-md-3">
		      <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
			<h1 class="h2">Algorithms</h1>
		      </div>
		</div>
		<main role="main" class="col-md-9 px-4"><div class="chartjs-size-monitor" style="position: absolute; left: 0px; top: 0px; right: 0px; bottom: 0px; overflow: hidden; pointer-events: none; visibility: hidden; z-index: -1;"><div class="chartjs-size-monitor-expand" style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1;"><div style="position:absolute;width:1000000px;height:1000000px;left:0;top:0"></div></div><div class="chartjs-size-monitor-shrink" style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1;"><div style="position:absolute;width:200%;height:200%;left:0; top:0"></div></div></div>
		      <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
			<h1 class="h2">Dashboard</h1>
			<div class="btn-toolbar mb-2 mb-md-0">
			  <div class="btn-group mr-2">
			    <button type="button" class="btn btn-sm btn-outline-secondary">Share</button>
			    <button type="button" class="btn btn-sm btn-outline-secondary">Export</button>
			  </div>
			  <button type="button" class="btn btn-sm btn-outline-secondary dropdown-toggle">
			    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
			    This week
			  </button>
			</div>
		      </div>

		      <canvas class="my-4 w-100 chartjs-render-monitor" id="myChart" width="1707" height="720" style="display: block; height: 480px; width: 1138px;"></canvas>

		      <h2>Section title</h2>
		      <div class="table-responsive">
			<table class="table table-striped table-sm">
			  <thead>
			    <tr>
			      <th>#</th>
			      <th>Header</th>
			      <th>Header</th>
			      <th>Header</th>
			      <th>Header</th>
			    </tr>
			  </thead>
			  <tbody>
			    <tr>
			      <td>1,001</td>
			      <td>Lorem</td>
			      <td>ipsum</td>
			      <td>dolor</td>
			      <td>sit</td>
			    </tr>
			    <tr>
			      <td>1,002</td>
			      <td>amet</td>
			      <td>consectetur</td>
			      <td>adipiscing</td>
			      <td>elit</td>
			    </tr>
			    <tr>
			      <td>1,003</td>
			      <td>Integer</td>
			      <td>nec</td>
			      <td>odio</td>
			      <td>Praesent</td>
			    </tr>
			    <tr>
			      <td>1,003</td>
			      <td>libero</td>
			      <td>Sed</td>
			      <td>cursus</td>
			      <td>ante</td>
			    </tr>
			    <tr>
			      <td>1,004</td>
			      <td>dapibus</td>
			      <td>diam</td>
			      <td>Sed</td>
			      <td>nisi</td>
			    </tr>
			    <tr>
			      <td>1,005</td>
			      <td>Nulla</td>
			      <td>quis</td>
			      <td>sem</td>
			      <td>at</td>
			    </tr>
			    <tr>
			      <td>1,006</td>
			      <td>nibh</td>
			      <td>elementum</td>
			      <td>imperdiet</td>
			      <td>Duis</td>
			    </tr>
			    <tr>
			      <td>1,007</td>
			      <td>sagittis</td>
			      <td>ipsum</td>
			      <td>Praesent</td>
			      <td>mauris</td>
			    </tr>
			    <tr>
			      <td>1,008</td>
			      <td>Fusce</td>
			      <td>nec</td>
			      <td>tellus</td>
			      <td>sed</td>
			    </tr>
			    <tr>
			      <td>1,009</td>
			      <td>augue</td>
			      <td>semper</td>
			      <td>porta</td>
			      <td>Mauris</td>
			    </tr>
			    <tr>
			      <td>1,010</td>
			      <td>massa</td>
			      <td>Vestibulum</td>
			      <td>lacinia</td>
			      <td>arcu</td>
			    </tr>
			    <tr>
			      <td>1,011</td>
			      <td>eget</td>
			      <td>nulla</td>
			      <td>Class</td>
			      <td>aptent</td>
			    </tr>
			    <tr>
			      <td>1,012</td>
			      <td>taciti</td>
			      <td>sociosqu</td>
			      <td>ad</td>
			      <td>litora</td>
			    </tr>
			    <tr>
			      <td>1,013</td>
			      <td>torquent</td>
			      <td>per</td>
			      <td>conubia</td>
			      <td>nostra</td>
			    </tr>
			    <tr>
			      <td>1,014</td>
			      <td>per</td>
			      <td>inceptos</td>
			      <td>himenaeos</td>
			      <td>Curabitur</td>
			    </tr>
			    <tr>
			      <td>1,015</td>
			      <td>sodales</td>
			      <td>ligula</td>
			      <td>in</td>
			      <td>libero</td>
			    </tr>
			  </tbody>
			</table>
		      </div>
		    </main>
		</div>
	</div>
</div>


<script>
	/*
	var canvas = document.getElementById("lineChart");
	var context = canvas.getContext("2d");
	context.fillStyle = "blue";
	context.fillRect(0, 0, canvas.width, canvas.height);
	var myLineChart = new Chart(context, {
		type: "line",
		data: {
			labels: ["January", "February", "March", "April", "May", "June", "July"],
			datasets: [{           
				label: "My First dataset",           
				data: [65, 59, 80, 81, 56, 55, 40],           
				backgroundColor: [             
					'rgba(105, 0, 132, .2)',           
				],           
				borderColor: [             
					'rgba(200, 99, 132, .7)',           
				],           
				borderWidth: 2         
			}],
		},
		options: {       
			scales: {
				yAxes: [{ 
					ticks: {
						beginAtZero: true
					}
				}]
			}
		}   
	});	
	*/
</script>

 <script>
    // Show this page as active
    $("#nav-map-link").addClass("active");

    // TODO: update this hard-coding?
    var centerLat = 45.84921;
    var centerLong = -116.73317;

    var pictures = [];
    var markerList = [];
    var infoWindow;

    // Collect posts and calculate their GPS center-point
    {% for picture in newestPictures %}
      pictures.push(new picture("{{picture.thumbnail.url}}",
        {{picture.geoY}},{{picture.geoX}}, "", "{{picture.user}}",
        "{{picture.description}}", "/picture/view/" + {{picture.id}} + "/"));
    {% endfor %}

    function picture(thumbnailUrl, lat, lng, location, user, description, link)
    {
      this.thumbnailUrl = thumbnailUrl;
      this.lat = lat;
      this.lng = lng;
      this.location = location;
      this.user = user;
      this.description = description;
      this.link = link;
    }

    function initMap() {
        infoWindow = new google.maps.InfoWindow({ content: "hello" });
        var mapDiv = document.getElementById('map');
        var map = new google.maps.Map(mapDiv, {
           center: {lat: centerLat, lng: centerLong},
           zoom: 7,
           mapTypeId: 'hybrid',
	   disableDefaultUI: true // Hide controls.
        });

	let locations = [];
        for (i = 0; i < pictures.length; i++) {
		
		let picture = pictures[i];

	/*
          markerList.push(new google.maps.Marker({
            map:map,
            draggable:false,
            animation: google.maps.Animation.DROP,
            position:{lat:pictures[i].lat, lng:pictures[i].long},
          }));

          var br = "<br />";
          var anchor1 = '<a href="'+pictures[i].link+'">';
          var content = '<b>'+pictures[i].user +"</b><br>" + anchor1 +' <img class="img-responsive" src="' + pictures[i].thumbnailUrl + '" alt="{{ picture.pic.url}}" align = "middle" id ="mainPicture" /> </a>'+
          'Posted by: <a href="user/profile/'+pictures[i].user+'/">'+pictures[i].user +"</a><br> Description: " + pictures[i].description;
	  
          google.maps.event.addListener(markerList[i], 'click', (function(content) {
            return function() {
		   infoWindow.setPosition(this.getPosition());
		   infoWindow.setContent( content );
		   infoWindow.open(map);
            };
          })(content));
	*/	

	  let pos = {lat: picture.lat, lng: picture.lng};
	  locations.push(new google.maps.LatLng(picture.lat, picture.lng));
	  let marker = new google.maps.Marker({
	      position: pos,
	      map: map,
	      title: 'Hello, World!'
	  });
	  console.log(pos);
        }

        // Set heat map.
	let heatmap = new google.maps.visualization.HeatmapLayer({
		data: locations,
		map: map,
		maxIntensity: 50,
		radius: 50,
		opacity: 0.5
	});	


	if (navigator.geolocation) {
		navigator.geolocation.getCurrentPosition(function (position) {
		     initialLocation = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
		     map.setCenter(initialLocation);
		});
	}
      }

      function adjustMap() {
        //$("#map").width($(window).width());
        //$("#map").height($(window).height() * .80);
      }

      // TODO: More universal placement of resize function?
      $( window ).resize(function() {
        adjustMap();
      });


      // Loading adjustment
      adjustMap();

    </script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/feather-icons/4.9.0/feather.min.js"></script>
    <script>
/* globals Chart:false, feather:false */  
(function () {   
	'use strict'    
	feather.replace()    
	// Graphs   
	var ctx = document.getElementById('myChart')   
	// eslint-disable-next-line no-unused-vars   
	var myChart = new Chart(ctx, {     
		type: 'line',     
		data: {       
			labels: [       
				'Sunday',         
				'Monday',         
				'Tuesday',         
				'Wednesday',         
				'Thursday',         
				'Friday',         
				'Saturday'       
			],       
			datasets: [{         
				data: [           
					15339,           
					21345,           
					18483,           
					24003,           
					23489,           
					24092,           
					12034         
				],         
				lineTension: 0,         
				backgroundColor: 'transparent',         
				borderColor: '#007bff',         
				borderWidth: 4,         
				pointBackgroundColor: '#007bff'       
			}]     
		},     
		options: {       
			scales: {         
				yAxes: [{           
					ticks: {            
						beginAtZero: false           
					}         
				}]       
			},       
			legend: {         
				display: false       
			}     
		}   
	}) 
}())
</script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCp587g3ut0dYnLfl2gfeWTc0fAxujtVcw&callback=initMap&libraries=visualization"></script>

{% endblock %}
