{% extends "base/newbase.html" %}
{% block airpact-content %}

<div class="container">
	<div class="row">
		<div class="col">
			<div id="map" class="" style="height: 400px; width: 100%;"> </div>
		</div>
		<div class="col">
			<canvas id="lineChart" style="height: 400px; width: 100%;"></canvas>	
		</div>
	</div>
</div>

<script>
	var canvas = document.getElementById("lineChart");
	var context = canvas.getContext("2d");
	context.fillStyle = "blue";
	context.fillRect(0, 0, canvas.width, canvas.height);
	var myLineChart = new Chart(context, {
		type: "line",
		data: {
			labels: ["January", "February", "March", "April", "May", "June", "July"],
			datasets: [{           
				label: "My First dataset",           
				data: [65, 59, 80, 81, 56, 55, 40],           
				backgroundColor: [             
					'rgba(105, 0, 132, .2)',           
				],           
				borderColor: [             
					'rgba(200, 99, 132, .7)',           
				],           
				borderWidth: 2         
			}],
		},
		options: {       
			scales: {
				yAxes: [{ 
					ticks: {
						beginAtZero: true
					}
				}]
			}
		}   
	});	
</script>

 <script>
    // Show this page as active
    $("#nav-map-link").addClass("active");

    // TODO: update this hard-coding?
    var centerLat = 45.84921;
    var centerLong = -116.73317;

    var pictures = [];
    var markerList = [];
    var infoWindow;

    // Collect posts and calculate their GPS center-point
    {% for picture in newestPictures %}
      pictures.push(new picture("{{picture.thumbnail.url}}",
        {{picture.geoY}},{{picture.geoX}}, "", "{{picture.user}}",
        "{{picture.description}}", "/picture/view/" + {{picture.id}} + "/"));
    {% endfor %}

    function picture(thumbnailUrl, lat, lng, location, user, description, link)
    {
      this.thumbnailUrl = thumbnailUrl;
      this.lat = lat;
      this.lng = lng;
      this.location = location;
      this.user = user;
      this.description = description;
      this.link = link;
    }

    function initMap() {
        infoWindow = new google.maps.InfoWindow({ content: "hello" });
        var mapDiv = document.getElementById('map');
        var map = new google.maps.Map(mapDiv, {
           center: {lat: centerLat, lng: centerLong},
           zoom: 7,
           mapTypeId: 'hybrid'
        });

        for (i = 0; i < pictures.length; i++) {
		
		let picture = pictures[i];

	/*
          markerList.push(new google.maps.Marker({
            map:map,
            draggable:false,
            animation: google.maps.Animation.DROP,
            position:{lat:pictures[i].lat, lng:pictures[i].long},
          }));

          var br = "<br />";
          var anchor1 = '<a href="'+pictures[i].link+'">';
          var content = '<b>'+pictures[i].user +"</b><br>" + anchor1 +' <img class="img-responsive" src="' + pictures[i].thumbnailUrl + '" alt="{{ picture.pic.url}}" align = "middle" id ="mainPicture" /> </a>'+
          'Posted by: <a href="user/profile/'+pictures[i].user+'/">'+pictures[i].user +"</a><br> Description: " + pictures[i].description;
	  
          google.maps.event.addListener(markerList[i], 'click', (function(content) {
            return function() {
		   infoWindow.setPosition(this.getPosition());
		   infoWindow.setContent( content );
		   infoWindow.open(map);
            };
          })(content));
	*/	

	  let pos = {lat: picture.lat, lng: picture.lng};
	  let marker = new google.maps.Marker({
	      position: pos,
	      map: map,
	      title: 'Hello, World!'
	  });
	  console.log(pos);
        }

	if (navigator.geolocation) {
		navigator.geolocation.getCurrentPosition(function (position) {
		     initialLocation = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
		     map.setCenter(initialLocation);
		});
	}
      }

      function adjustMap() {
        //$("#map").width($(window).width());
        //$("#map").height($(window).height() * .80);
      }

      // TODO: More universal placement of resize function?
      $( window ).resize(function() {
        adjustMap();
      });


      // Loading adjustment
      adjustMap();

    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCp587g3ut0dYnLfl2gfeWTc0fAxujtVcw&callback=initMap"></script>

{% endblock %}
